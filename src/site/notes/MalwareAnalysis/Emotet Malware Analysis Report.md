---
{"dg-publish":true,"permalink":"/malware-analysis/emotet-malware-analysis-report/","tags":["malware"]}
---

[[MalwareAnalysis/Malware Analysis\|Malware Analysis]]

September 04 | Alex Macenas | v1
### Executive Summary
---
Emotet is a info stealer trojan virus that appeared on the year 2014, it's malware delivery is in a form of Microsoft Document such as MS Word and MS Excel attached with a macro or a script that executes once the document is open, it contacts multiple domains to download the virus.

| SHA256  | d50d98dcc8b7043cb5c38c3de36a2ad62b293704e3cf23b0cd7450174df53fee |
| ------- | ---------------------------------------------------------------- |
## Static Analysis
---

VirusTotal score is 66/74 and using **oledump.py** found macros and event starts when document is open:

![Pasted image 20240903155055.png](/img/user/images/Pasted%20image%2020240903155055.png)
It calls a function name `boaxvoebxiotqueb` that is found on data stream #15:

![Pasted image 20240903155203.png](/img/user/images/Pasted%20image%2020240903155203.png)
Deobsfucated first part of the `.vba` script is replicated in python that produces: 

![Pasted image 20240903170349.png](/img/user/images/Pasted%20image%2020240903170349.png)
This line of code is responsible for opening **Windows Manament Instrument (WMI)**, it is used to interact and manage Windows processes:

![Pasted image 20240904151554.png](/img/user/images/Pasted%20image%2020240904151554.png)
And then in this part of the code is responsible for executing the PowerShell that is base64 encoded in data **stream 34**:

```vb
xve = Array _
("1234444123", assigned_win32_object. _
Create(geulgelquuuj, "", deavjoajsear), "9938723")
End Function
```

Deobsfucated version:

```vb
'Documentation: Create(commandLine, currentDirectory, processStartupInfo)'
assigned_win32_object.Create(PowerShell, "", "")
```

This assumes the `geulgelquuj` variable contains the data stream base64 encoded string. 

https://learn.microsoft.com/en-us/windows/win32/cimwin32prov/create-method-in-class-win32-process

A form with a name of `roubhaol` at data stream 18:
![Pasted image 20240903172759.png](/img/user/images/Pasted%20image%2020240903172759.png)

At data stream 19 is where the variable names are:

![Pasted image 20240903174002.png](/img/user/images/Pasted%20image%2020240903174002.png)
##### Deobsfucating Base64 encoded string
---
In the script, we found a function that is responsible for removing the paddings and getting the actual value (Refer to the python script):

![Pasted image 20240904153035.png](/img/user/images/Pasted%20image%2020240904153035.png)
Using the same delimeter found on the script: `2342772g3&*gs7712ffvs626fq` and then the output with tools such as cyberchef:

![Pasted image 20240904153305.png](/img/user/images/Pasted%20image%2020240904153305.png)
Once decoded back to it's original form and cleaned for readability, this is the result:

![Pasted image 20240904154737.png](/img/user/images/Pasted%20image%2020240904154737.png)

Interesting values at data stream 6:

![Pasted image 20240903175808.png](/img/user/images/Pasted%20image%2020240903175808.png)
## Dynamic Analysis
---
Initial detonation:
![Pasted image 20240904160056.png](/img/user/images/Pasted%20image%2020240904160056.png)
